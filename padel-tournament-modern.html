<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Padel Tournaments</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [view, setView] = useState('list');
            const [tournaments, setTournaments] = useState([]);
            const [currentTournament, setCurrentTournament] = useState(null);
            const [activeTab, setActiveTab] = useState('stage1');

            useEffect(() => {
                const saved = localStorage.getItem('padel_tournaments');
                if (saved) {
                    try {
                        setTournaments(JSON.parse(saved));
                    } catch (e) {
                        setTournaments([]);
                    }
                }
            }, []);

            useEffect(() => {
                localStorage.setItem('padel_tournaments', JSON.stringify(tournaments));
            }, [tournaments]);

            const createTournament = (tournamentData) => {
                const newTournament = {
                    id: Date.now(),
                    ...tournamentData,
                    status: 'stage1',
                    stage1Groups: generateGroups(tournamentData.pairs),
                    stage2Groups: null,
                    createdAt: new Date().toISOString()
                };
                setTournaments([...tournaments, newTournament]);
                setCurrentTournament(newTournament);
                setView('tournament');
                setActiveTab('stage1');
            };

            const generateGroups = (pairs) => {
                const groups = [];
                const pairsPerGroup = 4;
                const numGroups = Math.ceil(pairs.length / pairsPerGroup);

                for (let i = 0; i < numGroups; i++) {
                    const groupPairs = pairs.slice(i * pairsPerGroup, (i + 1) * pairsPerGroup);
                    const matches = generateMatches(groupPairs);
                    
                    groups.push({
                        id: i,
                        name: String.fromCharCode(65 + i),
                        pairs: groupPairs.map(p => ({
                            ...p,
                            played: 0,
                            won: 0,
                            lost: 0,
                            points: 0,
                            gamesWon: 0,
                            gamesLost: 0,
                            gamesDiff: 0
                        })),
                        matches: matches
                    });
                }

                return groups;
            };

            const generateMatches = (pairs) => {
                if (pairs.length !== 4) return [];
                
                return [
                    { round: 1, pair1: pairs[0], pair2: pairs[1], court: 1, set1p1: '', set1p2: '' },
                    { round: 1, pair1: pairs[2], pair2: pairs[3], court: 2, set1p1: '', set1p2: '' },
                    { round: 2, pair1: pairs[0], pair2: pairs[2], court: 1, set1p1: '', set1p2: '' },
                    { round: 2, pair1: pairs[1], pair2: pairs[3], court: 2, set1p1: '', set1p2: '' },
                    { round: 3, pair1: pairs[0], pair2: pairs[3], court: 1, set1p1: '', set1p2: '' },
                    { round: 3, pair1: pairs[1], pair2: pairs[2], court: 2, set1p1: '', set1p2: '' },
                ];
            };

            const updateMatchResult = (groupId, matchIndex, result, stage) => {
                const updatedTournaments = tournaments.map(t => {
                    if (t.id === currentTournament.id) {
                        const groupsKey = stage === 1 ? 'stage1Groups' : 'stage2Groups';
                        const updatedGroups = [...t[groupsKey]];
                        const group = updatedGroups[groupId];
                        
                        group.matches[matchIndex] = { ...group.matches[matchIndex], ...result };
                        
                        group.pairs = group.pairs.map(pair => ({
                            ...pair,
                            played: 0,
                            won: 0,
                            lost: 0,
                            points: 0,
                            gamesWon: 0,
                            gamesLost: 0,
                            gamesDiff: 0
                        }));

                        group.matches.forEach(match => {
                            if (match.set1p1 !== '' && match.set1p2 !== '') {
                                const p1Games = parseInt(match.set1p1) || 0;
                                const p2Games = parseInt(match.set1p2) || 0;
                                
                                const p1Idx = group.pairs.findIndex(p => p.id === match.pair1.id);
                                const p2Idx = group.pairs.findIndex(p => p.id === match.pair2.id);

                                if (p1Idx !== -1 && p2Idx !== -1) {
                                    group.pairs[p1Idx].played++;
                                    group.pairs[p2Idx].played++;
                                    group.pairs[p1Idx].gamesWon += p1Games;
                                    group.pairs[p1Idx].gamesLost += p2Games;
                                    group.pairs[p2Idx].gamesWon += p2Games;
                                    group.pairs[p2Idx].gamesLost += p1Games;

                                    if (p1Games > p2Games) {
                                        group.pairs[p1Idx].won++;
                                        group.pairs[p1Idx].points += 3;
                                        group.pairs[p2Idx].lost++;
                                    } else if (p2Games > p1Games) {
                                        group.pairs[p2Idx].won++;
                                        group.pairs[p2Idx].points += 3;
                                        group.pairs[p1Idx].lost++;
                                    }

                                    group.pairs[p1Idx].gamesDiff = group.pairs[p1Idx].gamesWon - group.pairs[p1Idx].gamesLost;
                                    group.pairs[p2Idx].gamesDiff = group.pairs[p2Idx].gamesWon - group.pairs[p2Idx].gamesLost;
                                }
                            }
                        });

                        group.pairs.sort((a, b) => {
                            if (b.points !== a.points) return b.points - a.points;
                            if (b.gamesDiff !== a.gamesDiff) return b.gamesDiff - a.gamesDiff;
                            return b.gamesWon - a.gamesWon;
                        });

                        updatedGroups[groupId] = group;
                        return { ...t, [groupsKey]: updatedGroups };
                    }
                    return t;
                });

                setTournaments(updatedTournaments);
                setCurrentTournament(updatedTournaments.find(t => t.id === currentTournament.id));
            };

            const generateStage2 = () => {
                const allPairs = [];
                currentTournament.stage1Groups.forEach(group => {
                    group.pairs.forEach(pair => {
                        allPairs.push({ ...pair });
                    });
                });

                allPairs.sort((a, b) => {
                    if (b.points !== a.points) return b.points - a.points;
                    if (b.gamesDiff !== a.gamesDiff) return b.gamesDiff - a.gamesDiff;
                    return b.gamesWon - a.gamesWon;
                });

                const pairsForStage2 = allPairs.map(p => ({
                    id: p.id,
                    number: p.number,
                    player1: p.player1,
                    player2: p.player2
                }));

                const stage2Groups = generateGroups(pairsForStage2);

                const updatedTournaments = tournaments.map(t => {
                    if (t.id === currentTournament.id) {
                        return { ...t, stage2Groups, status: 'stage2' };
                    }
                    return t;
                });

                setTournaments(updatedTournaments);
                setCurrentTournament(updatedTournaments.find(t => t.id === currentTournament.id));
                setActiveTab('stage2');
            };

            const completeTournament = () => {
                const updatedTournaments = tournaments.map(t => {
                    if (t.id === currentTournament.id) {
                        return { ...t, status: 'completed' };
                    }
                    return t;
                });

                setTournaments(updatedTournaments);
                setCurrentTournament(updatedTournaments.find(t => t.id === currentTournament.id));
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="mb-8 flex items-center justify-between">
                            <div>
                                <h1 className="text-4xl font-bold text-white mb-2">üéæ Padel Tournaments</h1>
                                <p className="text-gray-400">–°–∏—Å—Ç–µ–º–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ç—É—Ä–Ω–∏—Ä–æ–≤</p>
                            </div>
                        </div>

                        {view === 'list' && (
                            <TournamentList 
                                tournaments={tournaments}
                                onCreateNew={() => setView('create')}
                                onSelectTournament={(t) => {
                                    setCurrentTournament(t);
                                    setView('tournament');
                                    setActiveTab(t.status === 'stage1' ? 'stage1' : t.status === 'stage2' ? 'stage2' : 'final');
                                }}
                            />
                        )}

                        {view === 'create' && (
                            <CreateTournament 
                                onSubmit={createTournament}
                                onCancel={() => setView('list')}
                            />
                        )}

                        {view === 'tournament' && currentTournament && (
                            <TournamentView 
                                tournament={currentTournament}
                                activeTab={activeTab}
                                onTabChange={setActiveTab}
                                onUpdateMatch={updateMatchResult}
                                onGenerateStage2={generateStage2}
                                onComplete={completeTournament}
                                onBack={() => setView('list')}
                            />
                        )}
                    </div>
                </div>
            );
        }

        function TournamentList({ tournaments, onCreateNew, onSelectTournament }) {
            return (
                <div>
                    <div className="flex justify-between items-center mb-8">
                        <button 
                            className="bg-gradient-to-r from-emerald-500 to-teal-500 text-white px-8 py-4 rounded-2xl font-semibold hover:shadow-2xl hover:scale-105 transition-all duration-200"
                            onClick={onCreateNew}
                        >
                            + –°–æ–∑–¥–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä
                        </button>
                    </div>

                    {tournaments.length === 0 ? (
                        <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl p-20 text-center border border-gray-700">
                            <div className="text-8xl mb-6">üéæ</div>
                            <h3 className="text-2xl font-bold text-white mb-3">–ù–µ—Ç —Ç—É—Ä–Ω–∏—Ä–æ–≤</h3>
                            <p className="text-gray-400">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π —Ç—É—Ä–Ω–∏—Ä</p>
                        </div>
                    ) : (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {tournaments.map(t => (
                                <div 
                                    key={t.id} 
                                    className="bg-gradient-to-br from-blue-500 to-purple-600 rounded-3xl p-6 cursor-pointer hover:shadow-2xl hover:scale-105 transition-all duration-200"
                                    onClick={() => onSelectTournament(t)}
                                >
                                    <h3 className="text-2xl font-bold text-white mb-4">{t.name}</h3>
                                    <div className="text-blue-100 space-y-2 mb-4">
                                        <div className="flex items-center gap-2">
                                            <span>üìÖ</span>
                                            <span>{new Date(t.createdAt).toLocaleDateString('ru-RU')}</span>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            <span>üë•</span>
                                            <span>{t.pairs.length} –ø–∞—Ä</span>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            <span>üèüÔ∏è</span>
                                            <span>{t.courts} –∫–æ—Ä—Ç–æ–≤</span>
                                        </div>
                                    </div>
                                    <span className={`inline-block px-4 py-2 rounded-full text-sm font-bold ${
                                        t.status === 'completed' 
                                            ? 'bg-green-400 text-green-900' 
                                            : 'bg-yellow-400 text-yellow-900'
                                    }`}>
                                        {t.status === 'completed' ? '‚úì –ó–∞–≤–µ—Ä—à–µ–Ω' : t.status === 'stage2' ? '–≠—Ç–∞–ø 2' : '–≠—Ç–∞–ø 1'}
                                    </span>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        function CreateTournament({ onSubmit, onCancel }) {
            const [name, setName] = useState('');
            const [numPairs, setNumPairs] = useState(8);
            const [courts, setCourts] = useState(2);
            const [pairs, setPairs] = useState([]);

            useEffect(() => {
                const newPairs = [];
                for (let i = 0; i < numPairs; i++) {
                    newPairs.push({
                        id: i + 1,
                        number: i + 1,
                        player1: '',
                        player2: ''
                    });
                }
                setPairs(newPairs);
            }, [numPairs]);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!name.trim()) {
                    alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞');
                    return;
                }
                const emptyPairs = pairs.filter(p => !p.player1.trim() || !p.player2.trim());
                if (emptyPairs.length > 0) {
                    alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º–µ–Ω–∞ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤');
                    return;
                }
                onSubmit({ name, courts, pairs });
            };

            const updatePair = (index, field, value) => {
                const newPairs = [...pairs];
                newPairs[index][field] = value;
                setPairs(newPairs);
            };

            return (
                <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl p-8 border border-gray-700">
                    <h2 className="text-3xl font-bold text-white mb-8">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç—É—Ä–Ω–∏—Ä</h2>
                    <div className="space-y-6">
                        <div>
                            <label className="block font-semibold mb-3 text-gray-300">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞</label>
                            <input 
                                type="text" 
                                className="w-full p-4 bg-gray-700 border-2 border-gray-600 rounded-2xl text-white placeholder-gray-400 focus:border-blue-500 outline-none transition-all"
                                value={name}
                                onChange={(e) => setName(e.target.value)}
                                placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ß–µ–º–ø–∏–æ–Ω–∞—Ç –∫–ª—É–±–∞"
                            />
                        </div>

                        <div className="grid grid-cols-2 gap-6">
                            <div>
                                <label className="block font-semibold mb-3 text-gray-300">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä</label>
                                <select 
                                    className="w-full p-4 bg-gray-700 border-2 border-gray-600 rounded-2xl text-white focus:border-blue-500 outline-none transition-all"
                                    value={numPairs} 
                                    onChange={(e) => setNumPairs(parseInt(e.target.value))}
                                >
                                    <option value={8}>8 –ø–∞—Ä</option>
                                    <option value={12}>12 –ø–∞—Ä</option>
                                    <option value={16}>16 –ø–∞—Ä</option>
                                    <option value={20}>20 –ø–∞—Ä</option>
                                </select>
                            </div>

                            <div>
                                <label className="block font-semibold mb-3 text-gray-300">–ö–æ—Ä—Ç–æ–≤</label>
                                <input 
                                    type="number" 
                                    min="1" 
                                    max="10"
                                    className="w-full p-4 bg-gray-700 border-2 border-gray-600 rounded-2xl text-white focus:border-blue-500 outline-none transition-all"
                                    value={courts}
                                    onChange={(e) => setCourts(parseInt(e.target.value))}
                                />
                            </div>
                        </div>

                        <div>
                            <h3 className="font-bold text-xl mb-4 text-white">–ü–∞—Ä—ã —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</h3>
                            <div className="space-y-3 max-h-96 overflow-y-auto">
                                {pairs.map((pair, idx) => (
                                    <div key={pair.id} className="flex gap-3 items-center">
                                        <span className="font-semibold text-blue-400 min-w-20">#{pair.number}</span>
                                        <input 
                                            type="text"
                                            className="flex-1 p-3 bg-gray-700 border-2 border-gray-600 rounded-xl text-white placeholder-gray-400 focus:border-blue-500 outline-none transition-all"
                                            placeholder="–ò–≥—Ä–æ–∫ 1"
                                            value={pair.player1}
                                            onChange={(e) => updatePair(idx, 'player1', e.target.value)}
                                        />
                                        <span className="text-gray-500">/</span>
                                        <input 
                                            type="text"
                                            className="flex-1 p-3 bg-gray-700 border-2 border-gray-600 rounded-xl text-white placeholder-gray-400 focus:border-blue-500 outline-none transition-all"
                                            placeholder="–ò–≥—Ä–æ–∫ 2"
                                            value={pair.player2}
                                            onChange={(e) => updatePair(idx, 'player2', e.target.value)}
                                        />
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="flex gap-4 pt-4">
                            <button 
                                onClick={handleSubmit}
                                className="flex-1 bg-gradient-to-r from-emerald-500 to-teal-500 text-white px-8 py-4 rounded-2xl font-bold hover:shadow-2xl hover:scale-105 transition-all"
                            >
                                –°–æ–∑–¥–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä
                            </button>
                            <button 
                                onClick={onCancel}
                                className="px-8 py-4 bg-gray-700 text-white rounded-2xl font-bold hover:bg-gray-600 transition-all"
                            >
                                –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        function TournamentView({ tournament, activeTab, onTabChange, onUpdateMatch, onGenerateStage2, onComplete, onBack }) {
            const allStage1Completed = tournament.stage1Groups?.every(g => 
                g.matches.every(m => m.set1p1 !== '' && m.set1p2 !== '')
            );

            const allStage2Completed = tournament.stage2Groups?.every(g => 
                g.matches.every(m => m.set1p1 !== '' && m.set1p2 !== '')
            );

            return (
                <div>
                    <div className="flex justify-between items-center mb-8">
                        <button 
                            className="bg-gray-700 text-white px-6 py-3 rounded-2xl font-semibold hover:bg-gray-600 transition-all"
                            onClick={onBack}
                        >
                            ‚Üê –ù–∞–∑–∞–¥
                        </button>
                        <h2 className="text-3xl font-bold text-white">{tournament.name}</h2>
                        <div></div>
                    </div>

                    <div className="flex gap-3 mb-8 overflow-x-auto">
                        <button 
                            className={`px-6 py-3 font-bold rounded-2xl transition-all whitespace-nowrap ${
                                activeTab === 'stage1' 
                                    ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg' 
                                    : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                            }`}
                            onClick={() => onTabChange('stage1')}
                        >
                            –≠—Ç–∞–ø 1
                        </button>
                        <button 
                            className={`px-6 py-3 font-bold rounded-2xl transition-all whitespace-nowrap ${
                                activeTab === 'table1' 
                                    ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg' 
                                    : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                            } ${!allStage1Completed && 'opacity-50 cursor-not-allowed'}`}
                            onClick={() => allStage1Completed && onTabChange('table1')}
                            disabled={!allStage1Completed}
                        >
                            –¢–∞–±–ª–∏—Ü–∞ 1
                        </button>
                        {tournament.stage2Groups && (
                            <>
                                <button 
                                    className={`px-6 py-3 font-bold rounded-2xl transition-all whitespace-nowrap ${
                                        activeTab === 'stage2' 
                                            ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg' 
                                            : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                    }`}
                                    onClick={() => onTabChange('stage2')}
                                >
                                    –≠—Ç–∞–ø 2
                                </button>
                                <button 
                                    className={`px-6 py-3 font-bold rounded-2xl transition-all whitespace-nowrap ${
                                        activeTab === 'final' 
                                            ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg' 
                                            : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                    } ${!allStage2Completed && 'opacity-50 cursor-not-allowed'}`}
                                    onClick={() => allStage2Completed && onTabChange('final')}
                                    disabled={!allStage2Completed}
                                >
                                    –§–∏–Ω–∞–ª
                                </button>
                            </>
                        )}
                    </div>

                    {activeTab === 'stage1' && (
                        <StageView 
                            groups={tournament.stage1Groups}
                            stage={1}
                            onUpdateMatch={onUpdateMatch}
                        />
                    )}

                    {activeTab === 'table1' && (
                        <OverallTable 
                            groups={tournament.stage1Groups}
                            onGenerateStage2={onGenerateStage2}
                            showButton={!tournament.stage2Groups}
                        />
                    )}

                    {activeTab === 'stage2' && tournament.stage2Groups && (
                        <StageView 
                            groups={tournament.stage2Groups}
                            stage={2}
                            onUpdateMatch={onUpdateMatch}
                        />
                    )}

                    {activeTab === 'final' && tournament.stage2Groups && (
                        <FinalTable 
                            groups={tournament.stage2Groups}
                            onComplete={onComplete}
                            isCompleted={tournament.status === 'completed'}
                        />
                    )}
                </div>
            );
        }

        function StageView({ groups, stage, onUpdateMatch }) {
            const colors = [
                'from-rose-500 to-pink-500',
                'from-blue-500 to-cyan-500',
                'from-emerald-500 to-teal-500',
                'from-purple-500 to-indigo-500',
                'from-orange-500 to-amber-500'
            ];

            return (
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    {groups.map((group, idx) => (
                        <GroupView 
                            key={group.id} 
                            group={group} 
                            stage={stage} 
                            onUpdateMatch={onUpdateMatch}
                            colorClass={colors[idx % colors.length]}
                        />
                    ))}
                </div>
            );
        }

        function GroupView({ group, stage, onUpdateMatch, colorClass }) {
            const [editingMatch, setEditingMatch] = useState(null);

            return (
                <div className={`bg-gradient-to-br ${colorClass} rounded-3xl p-6 shadow-2xl`}>
                    <div className="text-3xl font-black text-white mb-6 text-center">
                        –ì–†–£–ü–ü–ê {group.name}
                    </div>
                    
                    <div className="bg-white bg-opacity-20 backdrop-blur-sm rounded-2xl p-4 mb-6">
                        <table className="w-full text-white text-sm">
                            <thead>
                                <tr className="border-b border-white border-opacity-30">
                                    <th className="p-2 text-left font-bold">–ú</th>
                                    <th className="p-2 text-left font-bold">–ü–∞—Ä–∞</th>
                                    <th className="p-2 text-center font-bold">–ò</th>
                                    <th className="p-2 text-center font-bold">–û</th>
                                    <th className="p-2 text-center font-bold">+/-</th>
                                </tr>
                            </thead>
                            <tbody>
                                {group.pairs.map((pair, idx) => (
                                    <tr key={pair.id} className="border-b border-white border-opacity-20">
                                        <td className="p-2"><span className="font-black text-lg">{idx + 1}</span></td>
                                        <td className="p-2">
                                            <div className="font-bold">#{pair.number}</div>
                                            <div className="text-xs opacity-90">{pair.player1}/{pair.player2}</div>
                                        </td>
                                        <td className="p-2 text-center">{pair.played}</td>
                                        <td className="p-2 text-center"><span className="font-black text-lg">{pair.points}</span></td>
                                        <td className={`p-2 text-center font-bold ${pair.gamesDiff > 0 ? 'text-green-300' : 'text-red-300'}`}>
                                            {pair.gamesDiff > 0 ? '+' : ''}{pair.gamesDiff}
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    <div className="space-y-3">
                        {[1, 2, 3].map(round => (
                            <div key={round}>
                                <div className="text-white font-bold mb-2 text-sm opacity-90">–†–ê–£–ù–î {round}</div>
                                {group.matches.filter(m => m.round === round).map((match, idx) => (
                                    <Match 
                                        key={idx}
                                        match={match}
                                        onEdit={() => setEditingMatch({ match, idx: group.matches.indexOf(match) })}
                                    />
                                ))}
                            </div>
                        ))}
                    </div>

                    {editingMatch && (
                        <ScoreModal 
                            match={editingMatch.match}
                            onSave={(result) => {
                                onUpdateMatch(group.id, editingMatch.idx, result, stage);
                                setEditingMatch(null);
                            }}
                            onClose={() => setEditingMatch(null)}
                        />
                    )}
                </div>
            );
        }

        function Match({ match, onEdit }) {
            const hasResult = match.set1p1 !== '' && match.set1p2 !== '';
            const p1Games = parseInt(match.set1p1) || 0;
            const p2Games = parseInt(match.set1p2) || 0;
            const winner = hasResult ? (p1Games > p2Games ? 1 : p1Games < p2Games ? 2 : 0) : 0;

            return (
                <div className="bg-white bg-opacity-20 backdrop-blur-sm rounded-xl p-3 flex justify-between items-center mb-2">
                    <div className="flex items-center gap-3 text-white">
                        <span className="bg-white bg-opacity-30 px-3 py-1 rounded-full text-xs font-bold">
                            –ö{match.court}
                        </span>
                        <span className="text-sm">
                            <strong className={winner === 1 ? 'text-green-300' : ''}>
                                #{match.pair1.number}
                            </strong>
                            {' vs '}
                            <strong className={winner === 2 ? 'text-green-300' : ''}>
                                #{match.pair2.number}
                            </strong>
                        </span>
                    </div>
                    
                    {hasResult ? (
                        <div className="flex gap-3 items-center">
                            <span className="text-white font-black text-lg">
                                {match.set1p1}:{match.set1p2}
                            </span>
                            <button 
                                className="bg-white bg-opacity-30 text-white px-3 py-1 rounded-lg text-xs font-bold hover:bg-opacity-40"
                                onClick={onEdit}
                            >
                                ‚úé
                            </button>
                        </div>
                    ) : (
                        <button 
                            className="bg-white text-gray-900 px-4 py-2 rounded-lg text-sm font-bold hover:bg-opacity-90"
                            onClick={onEdit}
                        >
                            –í–≤–µ—Å—Ç–∏
                        </button>
                    )}
                </div>
            );
        }

        function ScoreModal({ match, onSave, onClose }) {
            const [set1p1, setSet1p1] = useState(match.set1p1);
            const [set1p2, setSet1p2] = useState(match.set1p2);

            const handleSave = () => {
                if (set1p1 === '' || set1p2 === '') {
                    alert('–í–≤–µ–¥–∏—Ç–µ —Å—á–µ—Ç');
                    return;
                }
                onSave({ set1p1, set1p2 });
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4" onClick={onClose}>
                    <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl p-8 max-w-md w-full border border-gray-700" onClick={(e) => e.stopPropagation()}>
                        <h3 className="text-2xl font-bold text-white mb-3">–†–µ–∑—É–ª—å—Ç–∞—Ç –º–∞—Ç—á–∞</h3>
                        <p className="mb-6 text-gray-300">
                            <strong>#{match.pair1.number}</strong> vs <strong>#{match.pair2.number}</strong>
                        </p>
                        
                        <div className="mb-8">
                            <label className="block font-bold mb-3 text-white">–°—á–µ—Ç:</label>
                            <div className="flex items-center gap-4 justify-center">
                                <input 
                                    type="number" 
                                    min="0" 
                                    max="20"
                                    className="w-20 h-20 p-2 bg-gray-700 border-2 border-blue-500 rounded-2xl text-center text-white text-3xl font-bold focus:border-blue-400 outline-none"
                                    value={set1p1}
                                    onChange={(e) => setSet1p1(e.target.value)}
                                />
                                <span className="text-white text-4xl font-bold">:</span>
                                <input 
                                    type="number" 
                                    min="0" 
                                    max="20"
                                    className="w-20 h-20 p-2 bg-gray-700 border-2 border-purple-500 rounded-2xl text-center text-white text-3xl font-bold focus:border-purple-400 outline-none"
                                    value={set1p2}
                                    onChange={(e) => setSet1p2(e.target.value)}
                                />
                            </div>
                        </div>

                        <div className="flex gap-4">
                            <button 
                                className="flex-1 bg-gradient-to-r from-emerald-500 to-teal-500 text-white px-6 py-4 rounded-2xl font-bold hover:shadow-2xl transition-all"
                                onClick={handleSave}
                            >
                                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                            </button>
                            <button 
                                className="px-6 py-4 bg-gray-700 text-white rounded-2xl font-bold hover:bg-gray-600 transition-all"
                                onClick={onClose}
                            >
                                –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        function OverallTable({ groups, onGenerateStage2, showButton }) {
            const allPairs = [];
            groups.forEach(group => {
                group.pairs.forEach(pair => {
                    allPairs.push({ ...pair, group: group.name });
                });
            });

            allPairs.sort((a, b) => {
                if (b.points !== a.points) return b.points - a.points;
                if (b.gamesDiff !== a.gamesDiff) return b.gamesDiff - a.gamesDiff;
                return b.gamesWon - a.gamesWon;
            });

            return (
                <div className="bg-gradient-to-br from-blue-500 to-purple-600 rounded-3xl p-8 shadow-2xl">
                    <h3 className="text-3xl font-black text-white mb-6">–û–ë–©–ê–Ø –¢–ê–ë–õ–ò–¶–ê</h3>
                    
                    <div className="bg-white bg-opacity-20 backdrop-blur-sm rounded-2xl overflow-hidden mb-6">
                        <table className="w-full text-white">
                            <thead>
                                <tr className="border-b border-white border-opacity-30">
                                    <th className="p-4 text-left font-bold">–ú</th>
                                    <th className="p-4 text-left font-bold">–ì—Ä</th>
                                    <th className="p-4 text-left font-bold">–ü–∞—Ä–∞</th>
                                    <th className="p-4 text-center font-bold">–û</th>
                                    <th className="p-4 text-center font-bold">+/-</th>
                                </tr>
                            </thead>
                            <tbody>
                                {allPairs.map((pair, idx) => (
                                    <tr key={pair.id} className="border-b border-white border-opacity-20">
                                        <td className="p-4"><span className="font-black text-2xl">{idx + 1}</span></td>
                                        <td className="p-4 font-bold">{pair.group}</td>
                                        <td className="p-4">
                                            <div className="font-bold">#{pair.number}</div>
                                            <div className="text-sm opacity-90">{pair.player1}/{pair.player2}</div>
                                        </td>
                                        <td className="p-4 text-center"><span className="font-black text-xl">{pair.points}</span></td>
                                        <td className={`p-4 text-center font-bold text-lg ${pair.gamesDiff > 0 ? 'text-green-300' : 'text-red-300'}`}>
                                            {pair.gamesDiff > 0 ? '+' : ''}{pair.gamesDiff}
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    {showButton && (
                        <button 
                            className="w-full bg-white text-purple-600 px-8 py-4 rounded-2xl font-black text-lg hover:shadow-2xl hover:scale-105 transition-all"
                            onClick={onGenerateStage2}
                        >
                            –ü–ï–†–ï–ô–¢–ò –ö –≠–¢–ê–ü–£ 2 ‚Üí
                        </button>
                    )}
                </div>
            );
        }

        function FinalTable({ groups, onComplete, isCompleted }) {
            const finalStandings = [];
            
            groups.forEach((group, groupIdx) => {
                const sortedPairs = [...group.pairs].sort((a, b) => {
                    if (b.points !== a.points) return b.points - a.points;
                    if (b.gamesDiff !== a.gamesDiff) return b.gamesDiff - a.gamesDiff;
                    return b.gamesWon - a.gamesWon;
                });

                sortedPairs.forEach((pair, pairIdx) => {
                    finalStandings.push({
                        ...pair,
                        finalPlace: groupIdx * 4 + pairIdx + 1,
                        group: group.name
                    });
                });
            });

            finalStandings.sort((a, b) => a.finalPlace - b.finalPlace);

            return (
                <div className="bg-gradient-to-br from-yellow-500 via-orange-500 to-red-500 rounded-3xl p-8 shadow-2xl">
                    <h3 className="text-4xl font-black text-white mb-6 text-center">üèÜ –§–ò–ù–ê–õ–¨–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê</h3>
                    
                    <div className="bg-white bg-opacity-20 backdrop-blur-sm rounded-2xl overflow-hidden mb-6">
                        <table className="w-full text-white">
                            <thead>
                                <tr className="border-b border-white border-opacity-30">
                                    <th className="p-4 text-left font-bold">–ú–µ—Å—Ç–æ</th>
                                    <th className="p-4 text-left font-bold">–ü–∞—Ä–∞</th>
                                    <th className="p-4 text-center font-bold">–û—á–∫–∏</th>
                                    <th className="p-4 text-center font-bold">+/-</th>
                                </tr>
                            </thead>
                            <tbody>
                                {finalStandings.map((pair) => {
                                    const badgeColor = 
                                        pair.finalPlace === 1 ? 'bg-yellow-300 text-yellow-900' :
                                        pair.finalPlace === 2 ? 'bg-gray-300 text-gray-900' :
                                        pair.finalPlace === 3 ? 'bg-orange-300 text-orange-900' : 'bg-white bg-opacity-50';

                                    return (
                                        <tr key={pair.id} className="border-b border-white border-opacity-20">
                                            <td className="p-4">
                                                <span className={`inline-flex items-center justify-center w-12 h-12 rounded-full ${badgeColor} font-black text-xl`}>
                                                    {pair.finalPlace}
                                                </span>
                                            </td>
                                            <td className="p-4">
                                                <div className="font-bold text-lg">#{pair.number}</div>
                                                <div className="text-sm opacity-90">{pair.player1}/{pair.player2}</div>
                                            </td>
                                            <td className="p-4 text-center"><span className="font-black text-2xl">{pair.points}</span></td>
                                            <td className={`p-4 text-center font-bold text-xl ${pair.gamesDiff > 0 ? 'text-green-300' : 'text-red-300'}`}>
                                                {pair.gamesDiff > 0 ? '+' : ''}{pair.gamesDiff}
                                            </td>
                                        </tr>
                                    );
                                })}
                            </tbody>
                        </table>
                    </div>

                    {!isCompleted && (
                        <button 
                            className="w-full bg-white text-orange-600 px-8 py-4 rounded-2xl font-black text-lg hover:shadow-2xl hover:scale-105 transition-all"
                            onClick={onComplete}
                        >
                            ‚úì –ó–ê–í–ï–†–®–ò–¢–¨ –¢–£–†–ù–ò–†
                        </button>
                    )}
                    
                    {isCompleted && (
                        <div className="text-center py-8 bg-white bg-opacity-20 backdrop-blur-sm rounded-2xl">
                            <div className="text-6xl mb-4">üèÜ</div>
                            <div className="text-white text-3xl font-black">–¢–£–†–ù–ò–† –ó–ê–í–ï–†–®–ï–ù!</div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
